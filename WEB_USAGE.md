# 小说生成系统 - Web界面使用指南

## 🚀 快速开始

### 1. 启动服务器
```bash
python start_web.py
```

### 2. 访问界面
打开浏览器访问: http://localhost:5000

## 📝 功能介绍

### 一、模版管理
创建和管理提示词模版，包含三个核心文件：
- **角色定义** (writer_role.txt): 定义AI的身份和写作风格
- **写作规则** (writing_rules.txt): 设定执行规则和输出格式  
- **状态更新规则** (update_state_rules.txt): 指导状态JSON的更新逻辑

### 二、小说生成 ⭐ **新增小说ID隔离功能**

#### 📖 小说ID管理
- **输入小说ID**: 为每个小说项目设置唯一标识符（如: `novel001`, `fantasy_story`）
- **加载按钮**: 检查指定ID的小说是否存在，显示当前状态信息
- **列表按钮**: 查看所有已存在的小说项目
- **状态隔离**: 每个小说ID拥有独立的状态文件和设定

#### 🎯 生成配置
- **模版选择**: 选择预设的提示词模版
- **模型选择**: 支持多种AI模型（DeepSeek、GPT等）
- **生成设置**: 控制状态和世界设定的使用
- **章节内容设置**: ⭐ **新增功能** - 控制是否读取前面章节的实际文件内容
- **章节数量**: 设置读取前面几章的内容（1-10章）

#### 📖 章节内容功能详解 ⭐ **重要功能**
- **读取前面章节内容**: 启用后，系统会从xiaoshuo目录读取前面已保存的章节文件
- **智能衔接**: 确保前后章节内容的逻辑一致性和情节连贯性
- **实时同步**: 基于最新的章节文件内容生成，确保内容同步

#### 📋 章节计划
输入JSON格式的章节计划，例如：
```json
{
  "chapter_index": 1,
  "title": "第一章：觉醒",
  "main_plot": "主角发现自己的特殊能力",
  "chapter_outline": [
    "平凡的日常生活",
    "意外事件触发", 
    "能力觉醒时刻",
    "新世界的预告"
  ],
  "target_word_count": 2500,
  "mood": "神秘紧张"
}
```



## 🗂️ 文件组织结构

### 统一ID隔离机制 ⭐ **简化设计**
使用小说ID作为唯一标识符，统一管理所有相关数据：

```
data/                                    # 状态和设定文件
├── novel001_chapter_001_state.json     # 小说001的第1章状态
├── novel001_chapter_002_state.json     # 小说001的第2章状态  
├── novel001_world_bible_00.json        # 小说001的世界设定
├── fantasy_chapter_001_state.json      # fantasy小说的第1章状态
└── fantasy_world_bible_00.json         # fantasy小说的世界设定

xiaoshuo/                                # 章节内容文件
├── novel001_chapter_001.txt            # 小说001的第1章内容
├── novel001_chapter_002.txt            # 小说001的第2章内容
├── fantasy_chapter_001.txt             # fantasy小说的第1章内容
└── novel001_novel_20240115_143022.txt  # 保存的完整内容



versions/                                # 多版本文件
├── novel001_chapter_1_versions.json    # 小说001第1章的多版本
└── fantasy_chapter_1_versions.json     # fantasy小说第1章的多版本
```

### 设计优势
- **统一管理**: 一个小说ID对应一套完整的数据（状态+文件）
- **逻辑清晰**: 不再需要区分"小说ID"和"会话ID"
- **用户友好**: 界面更简洁，只需要一个ID输入框
- **数据一致性**: 同一小说的所有相关数据都用同一个ID管理

### 兼容性说明
- 如果不输入小说ID，系统将使用默认标识符（向后兼容）
- 现有的无ID文件仍可正常读取和使用

## ⚙️ 高级功能

### 状态管理
- 自动跟踪角色属性、物品、关系等状态变化
- 每章生成后可自动更新状态JSON

### 多版本生成
- 支持为同一章节生成多个不同版本
- 便于选择最佳内容或进行对比



## 🔧 故障排除

### 常见问题
1. **API连接失败**: 确保后端服务已启动
2. **生成失败**: 检查API密钥配置和网络连接
3. **模版加载失败**: 确认templates目录存在且有读写权限
4. **小说ID冲突**: 使用唯一的小说ID避免冲突

### 日志查看
检查控制台输出获取详细错误信息：
```bash
# 启动时的详细日志
python start_web.py
```

## 💡 最佳实践

### 小说ID命名建议
- 使用有意义的名称：`scifi_adventure`, `romance_novel`
- 避免特殊字符，推荐使用字母、数字、下划线
- 保持简短但具有描述性

### 章节计划编写
- 明确章节目标和情节发展
- 设置合理的字数目标（建议2000-3000字）
- 包含足够的细节指导AI创作

### 状态管理
- 定期检查和更新角色状态
- 保持状态信息的一致性和逻辑性
- 备份重要的状态文件



---

🎭 **小说生成系统** - 让AI助力你的创作之旅！